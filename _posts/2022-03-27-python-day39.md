---
layout: single
title: "[Python] íŒŒì´ì¬ ì±Œë¦°ì§€ Day39(Flight Deal Finder)"
categories: python
tags: [python, coding, api, 100DaysOfPython, Day39, 2022/03/27]
toc: true
toc_sticky: true
author_profile: true
comments: true
share: true
related: true
published: true
sidebar: 
    nav: "docs"
---

## 1. ì„œë¡   

&nbsp;&nbsp;&nbsp;&nbsp;íŒŒì´ì¬ ê³µë¶€ë¥¼ ìœ„í•´ Udemyì— ìˆëŠ” [100 Days of Code: The Complete Python Pro Bootcamp for 2022](https://www.udemy.com/course/100-days-of-code/) ê³¼ì •ì„ ë“£ê³  ìˆë‹¤. ì´ í¬ìŠ¤íŠ¸ì—ì„œëŠ” Day1-100 ì¤‘ Day39ì—ì„œ ë§Œë“¤ì—ˆë˜ Flight Deal Finderì— ëŒ€í•˜ì—¬ ë¦¬ë·°í•´ë³´ë ¤ê³  í•œë‹¤.

## 2. ë³¸ë¡   

### 1. Flight Deal Finder  

<img alt="google_sheet" src="https://user-images.githubusercontent.com/97603503/160282496-96de96bd-947d-4414-861b-659ea2d16004.png" width=300>
<img alt="google_sheet" src="https://user-images.githubusercontent.com/97603503/160282826-16162f25-13a6-4d27-8003-b2a38dea99e2.png" width=400>  

&nbsp;&nbsp;&nbsp;&nbsp;ğŸ¤” ë¬¸ì œëŠ” êµ¬ê¸€ ì‹œíŠ¸ì— ì—¬í–‰ê°€ê³ ì‹¶ì€ ë„ì‹œì™€ ì¢‹ì€ ë”œì´ë¼ê³  ìƒê°ë˜ëŠ” ê°€ê²©ì„ ì ì€ í›„, í•´ë‹¹ ì •ë³´ë¥¼ [Sheety](https://sheety.co/)ì˜ apiì™€ [Tequila(kiwi)](https://tequila.kiwi.com/)ì˜ apië¥¼ ì´ìš©í•˜ì—¬ ì•ìœ¼ë¡œ 6ê°œì›”ê°„ ì¢‹ì€ ê°€ê²©ëŒ€ì˜ ì§í•­ í•­ê³µê¶Œì´ ìˆìœ¼ë©´ ì•Œë¦¼ì„ ë³´ë‚´ëŠ” ì½”ë“œë¥¼ ì§œëŠ” ê²ƒì´ì—ˆë‹¤. ê·¸ë¦¬ê³  ì™„ì„±ëœ ì½”ë“œëŠ” [github](https://github.com/slowkoding/The-Complete-Python-Pro-Bootcamp-for-2022/tree/main/day39(flight_deals_alert))ì—ë„ ì—…ë¡œë“œ í•˜ì˜€ë‹¤.       

â¬‡ï¸ ì‘ì„±í•œ ì½”ë“œ â¬‡ï¸  

- main.py

```
#This file will need to use the DataManager,FlightSearch, FlightData, NotificationManager classes to achieve the program requirements.
from data_manager import DataManager
from datetime import datetime
from flight_search import FlightSearch
from notification_manager import NotificationManager

start_time = datetime.now()

data_manager = DataManager()
# sheetì˜ IATA Code ì—…ë°ì´íŠ¸ / ìµœì´ˆ 1íšŒë§Œ ì‹¤í–‰
# data_manager.update_destination_code()
iata_list = data_manager.get_iata_list()
price_from_google_sheet = data_manager.get_price_list()

flight_search = FlightSearch()
price_from_kiwi = flight_search.get_price_from_kiwi(iata_list)

# í‚¤ìœ„ì—ì„œ ì–»ì–´ì˜¨ ê°’(ì‚¬ì „í˜•)ìœ¼ë¡œë¶€í„° í‚¤ê°’ë§Œ ì¶”ì¶œ
existent_iata = list(price_from_kiwi.keys())

for i in range(len(existent_iata)):
    
    # kiwië¡œë¶€í„° ë°›ì•„ì˜¨ ê°€ê²©ì´ êµ¬ê¸€ì‹œíŠ¸ì˜ ê°€ê²©ë³´ë‹¤ ë‚®ì€ì§€ í™•ì¸ í›„ ë©”ì„¸ì§€ ë°œì†¡
    if int(price_from_google_sheet[existent_iata[i]]) > price_from_kiwi[existent_iata[i]]:
        formatted_message = flight_search.find_flights(existent_iata, i)
        NotificationManager(formatted_message) 

print(datetime.now() - start_time)
```  

- data_manager.py

```
import config
import requests
import gspread
from oauth2client.service_account import ServiceAccountCredentials
import pprint

TEQUILA_ENDPOINT = "https://tequila-api.kiwi.com"
TEQUILA_API_KEY = config.TEQUILA_API

class DataManager:
    
    # This class is responsible for talking to the Google Sheet.
    def __init__(self):
        
        # use creds to create a client to interact with the Google Drive API
        scope = ['https://www.googleapis.com/auth/spreadsheets', 'https://www.googleapis.com/auth/drive.readonly']
        creds = ServiceAccountCredentials.from_json_keyfile_name("flight-deals.json", scope)
        self.client = gspread.authorize(creds)
        
        # Find a workbook by name and open the first sheet
        self.google_sheet = self.client.open("Flight Deals").sheet1 

    # ë„ì°©ì§€ iata codeë¥¼ ì–»ëŠ” í•¨ìˆ˜
    def get_destination_code(self, city_name):
        
        headers = {
            "apikey": TEQUILA_API_KEY
        }
        config = {
            "term": city_name,
            "location type": "city"
        }
        response = requests.get(url=f"{TEQUILA_ENDPOINT}/locations/query", headers=headers, params=config)
        
        # jsonì—ì„œ locationsì— í•´ë‹¹í•˜ëŠ” ë¶€ë¶„ ë°›ì•„ì˜¤ê¸°
        self.results = response.json()["locations"]
        # pprint.pprint(results)
        code = self.results[0]["code"]
        return code

    def update_destination_code(self):
        
        # êµ¬ê¸€ì‹œíŠ¸ì—ì„œ city ì…€ì„ ì°¾ì€ í›„, í•´ë‹¹ ì—´ ê°’ ë°›ì•„ì˜¤ê¸°
        city_cell = self.google_sheet.find("City")
        cities = self.google_sheet.col_values(city_cell.col)
        
        # êµ¬ê¸€ì‹œíŠ¸ì—ì„œ iata ì…€ ì°¾ê¸°
        iata_cell = self.google_sheet.find("IATA Code")
        
        # resultsì—ì„œ ì²«ë²ˆì§¸ ë¦¬ìŠ¤íŠ¸ì˜ "code"ì— í•´ë‹¹í•˜ëŠ” ê°’ ë°›ì•„ì˜¤ê¸°
        for i in range(1, len(cities)):
            self.google_sheet.update_cell((iata_cell.row + i),
            iata_cell.col,
            self.get_destination_code(cities[i]))
    
    def get_iata_list(self):
        
        # êµ¬ê¸€ì‹œíŠ¸ì—ì„œ iata ì…€ ì°¾ê¸°
        iata_cell = self.google_sheet.find("IATA Code")
        # iata ì…€ì´ í•´ë‹¹í•˜ëŠ” ì—´ì˜ ë°ì´í„° ë°›ì•„ì˜¨ í›„ ì²«ë²ˆì§¸ ì…€ ì—†ì• ê¸°
        self.iata_code = self.google_sheet.col_values(iata_cell.col)
        del self.iata_code[0]
        
        return self.iata_code
    
    def get_price_list(self):
        
        # êµ¬ê¸€ì‹œíŠ¸ì—ì„œ Lowest Priceì…€ì„ ì°¾ì€ í›„, í•´ë‹¹ ì—´ ê°’ ë°›ì•„ì˜¤ê¸°
        price_cell = self.google_sheet.find("Lowest Price")
        prices = self.google_sheet.col_values(price_cell.col)
        del prices[0]
        
        price_dict = {}
        
        for i in range(0, len(prices)):
            price_dict[self.iata_code[i]] = prices[i]
            
        return price_dict
```  

- flight_search.py

```
import config
import requests
import gspread
from oauth2client.service_account import ServiceAccountCredentials
import pprint

TEQUILA_ENDPOINT = "https://tequila-api.kiwi.com"
TEQUILA_API_KEY = config.TEQUILA_API

class DataManager:
    
    # This class is responsible for talking to the Google Sheet.
    def __init__(self):
        
        # use creds to create a client to interact with the Google Drive API
        scope = ['https://www.googleapis.com/auth/spreadsheets', 'https://www.googleapis.com/auth/drive.readonly']
        creds = ServiceAccountCredentials.from_json_keyfile_name("flight-deals.json", scope)
        self.client = gspread.authorize(creds)
        
        # Find a workbook by name and open the first sheet
        self.google_sheet = self.client.open("Flight Deals").sheet1 

    # ë„ì°©ì§€ iata codeë¥¼ ì–»ëŠ” í•¨ìˆ˜
    def get_destination_code(self, city_name):
        
        headers = {
            "apikey": TEQUILA_API_KEY
        }
        config = {
            "term": city_name,
            "location type": "city"
        }
        response = requests.get(url=f"{TEQUILA_ENDPOINT}/locations/query", headers=headers, params=config)
        
        # jsonì—ì„œ locationsì— í•´ë‹¹í•˜ëŠ” ë¶€ë¶„ ë°›ì•„ì˜¤ê¸°
        self.results = response.json()["locations"]
        # pprint.pprint(results)
        code = self.results[0]["code"]
        return code

    def update_destination_code(self):
        
        # êµ¬ê¸€ì‹œíŠ¸ì—ì„œ city ì…€ì„ ì°¾ì€ í›„, í•´ë‹¹ ì—´ ê°’ ë°›ì•„ì˜¤ê¸°
        city_cell = self.google_sheet.find("City")
        cities = self.google_sheet.col_values(city_cell.col)
        
        # êµ¬ê¸€ì‹œíŠ¸ì—ì„œ iata ì…€ ì°¾ê¸°
        iata_cell = self.google_sheet.find("IATA Code")
        
        # resultsì—ì„œ ì²«ë²ˆì§¸ ë¦¬ìŠ¤íŠ¸ì˜ "code"ì— í•´ë‹¹í•˜ëŠ” ê°’ ë°›ì•„ì˜¤ê¸°
        for i in range(1, len(cities)):
            self.google_sheet.update_cell((iata_cell.row + i),
            iata_cell.col,
            self.get_destination_code(cities[i]))
    
    def get_iata_list(self):
        
        # êµ¬ê¸€ì‹œíŠ¸ì—ì„œ iata ì…€ ì°¾ê¸°
        iata_cell = self.google_sheet.find("IATA Code")
        # iata ì…€ì´ í•´ë‹¹í•˜ëŠ” ì—´ì˜ ë°ì´í„° ë°›ì•„ì˜¨ í›„ ì²«ë²ˆì§¸ ì…€ ì—†ì• ê¸°
        self.iata_code = self.google_sheet.col_values(iata_cell.col)
        del self.iata_code[0]
        
        return self.iata_code
    
    def get_price_list(self):
        
        # êµ¬ê¸€ì‹œíŠ¸ì—ì„œ Lowest Priceì…€ì„ ì°¾ì€ í›„, í•´ë‹¹ ì—´ ê°’ ë°›ì•„ì˜¤ê¸°
        price_cell = self.google_sheet.find("Lowest Price")
        prices = self.google_sheet.col_values(price_cell.col)
        del prices[0]
        
        price_dict = {}
        
        for i in range(0, len(prices)):
            price_dict[self.iata_code[i]] = prices[i]
            
        return price_dict
```  

- notification_manager.py

```
import requests
import config

class NotificationManager:
    
    #This class is responsible for sending notifications with the deal flight details.
    def __init__(self, bot_message):
        
        self.send_text = f"https://api.telegram.org/bot{config.BOT_TOCKEN}/sendMessage?chat_id={config.BOT_CHAT_ID}&parse_mode=Markdown&text={bot_message}"
        self.response = requests.get(self.send_text)
```  

- flight-deals.json

```
# google sheetì˜ ì¸ì¦ ì •ë³´
```  

- config.py

```
# api ë“±ì˜ ê°œì¸ì •ë³´ëŠ” ì´ íŒŒì¼ì— ë”°ë¡œ ì €ì¥í•´ë‘ì—ˆë‹¤. 
```  

<img alt="qna" src="https://user-images.githubusercontent.com/97603503/160283396-16c2d5b0-6ffb-4d23-85e7-5a836db9819a.png" >
<img alt="qna2" src="https://user-images.githubusercontent.com/97603503/160283613-68f6ea64-fb0d-44ef-907c-f2eb6ecac4c6.png">

&nbsp;&nbsp;&nbsp;&nbsp;âœ”ï¸ ì´ë²ˆ ì±Œë¦°ì§€ë¥¼ í†µí•˜ì—¬ ë°°ìš´ ë¶€ë¶„ì´ë‚˜ ëŠë‚€ì ì€ âœ”ï¸
- <b>í˜¼ì ê³µë¶€ë¥¼ í•˜ë©´ì„œ ìƒê°ì´ ê°€ì¥ ë§ì•„ì§ˆ ë•ŒëŠ” ë‚´ê°€ ê³¼ì—° ì˜¬ë°”ë¥¸ ê¸¸ë¡œ ì˜ ë°°ìš°ê³  ìˆëŠ”ì§€ ìŠ¤ìŠ¤ë¡œ ì˜ë¬¸ì´ ë“œëŠ” ìˆœê°„ë“¤ì´ë‹¤. íŠ¹íˆ ê¸¸ì–´ë„ 1-2ì‹œê°„ ê³ ë¯¼í•˜ë©´ í•´ê²°ë˜ë˜ ì§€ë‚œ dayë“¤ì˜ ì±Œë¦°ì§€ë“¤ê³¼ ë‹¬ë¦¬ ì´ë²ˆ ì±Œë¦°ì§€ëŠ” ë¬´ë ¤ 3ì¼ì´ ê±¸ë ¸ë‹¤. ê³ ë¯¼í•˜ê³  ì½”ë”©í–ˆë‹¤ê°€ í¬ê¸°í•˜ê³  ì‹¶ì€ ìˆœê°„ë“¤ì˜ ë°˜ë³µì´ì—ˆë‹¤. íŠ¹íˆ ìœ„ì˜ ì‚¬ì§„ 2ê°œëŠ” ê°€ì¥ ì—…ë³´íŠ¸ë¥¼ ë§ì´ë°›ì€ QnA ê¸€ì´ë©° ë‚´ ë§ˆìŒì„ ê·¸ëŒ€ë¡œ ì˜®ê²¨ì ì€ ê²ƒ ê°™ì•˜ë‹¤. í•˜ì§€ë§Œ ë”ì´ìƒ ì§„í–‰ì„ ëª»í•  ê²ƒ ê°™ì„ ë•ŒëŠ” ë‚´ë ¤ë†“ì•˜ë‹¤ê°€ ë‹¤ìŒë‚  ë‹¤ì‹œ ì´ì–´ê°€ê¸°ë¥¼ 3ì¼ì§¸, ë“œë””ì–´ ì™„ì„±ì„ í–ˆë‹¤. ê·¸ë¦¬ê³  ê°€ì¥ ê¸´ ì‹œê°„ì´ ê±¸ë¦°ë§Œí¼, ê°€ì¥ ë§ì´ ë°°ì›Œê°„ ê²ƒ ê°™ë‹¤.</b>
- <b>ìµœê·¼ dayë“¤ì€ ë™ì˜ìƒ ê°•ì˜ê°€ ì—†ì´ instructionsê³¼ ì™„ì„±ëœ ì½”ë“œë“¤ë§Œ ì£¼ì–´ì¡Œë‹¤. ê·¸ë˜ì„œ ê·¸ë™ì•ˆ ë°°ìš´ apië¥¼ í™œìš©í•˜ë©´ì„œë„ OOPë°©ì‹, ê·¸ê²ƒë„ ì—¬íƒœê¹Œì§€ í–ˆë˜ê²ƒ ì¤‘ ê°€ì¥ ë³µì¡í•œ ë°©ì‹ìœ¼ë¡œ êµ¬í˜„í•´ì•¼ í•˜ëŠ”ê²Œ ë„ˆë¬´ ë§‰ë§‰í–ˆë‹¤. ê·¸ë˜ì„œ ê³ ë¯¼ëì— ì²˜ìŒì—ëŠ” ë‹¨ê³„ë³„ë¡œ ë‚˜ë‰˜ì–´ì§„ solution codeë“¤ ì¤‘ ì²« ë²ˆì§¸ ì½”ë“œë¥¼ ê·¸ëŒ€ë¡œ ê°€ì ¸ì™€ ë¶„ì„í–ˆë‹¤. ë¶„ì„ë„ ë„ˆë¬´ ì–´ë ¤ì› ì§€ë§Œ, ë¶„ì„í–ˆë‹¤ê³  ë‚´ ê²ƒì´ ëë‹¤ê³ ëŠ” í•  ìˆ˜ ì—†ê¸°ì— sheetyì˜ apië¥¼ ì‚¬ìš©í•œ solution codeì—ì„œ google apië¥¼ ì‚¬ìš©í•  ìˆ˜ë„ ìˆë‹¤ëŠ” í•œ í•™ìƒì˜ QnAê¸€ì„ ë³´ê³  sheetyì˜ apië¥¼ í™œìš©í•˜ëŠ” ë¶€ë¶„ë“¤ì„ google apië¥¼ í™œìš©í•˜ë„ë¡ ëª¨ë‘ ë°”ê¾¸ì—ˆë‹¤. </b>
- <b>ì²˜ìŒìœ¼ë¡œ ì‹¤í–‰ì‹œê°„ì— ì‹ ê²½ì„ ì¨ë´¤ë‹¤. ì‚¬ì‹¤ ê³ ë¹ˆë„ ìˆ˜í–‰ì„ ìš”í•˜ëŠ”ê²Œ ì•„ë‹ˆê¸° ë•Œë¬¸ì— ìˆ˜í–‰ ì‹œê°„ì´ í¬ê²Œ ìƒê´€ì€ ì—†ì§€ë§Œ, ê·¸ë˜ë„ ì½”ë“œê°€ ë„ˆë¬´ ë³µì¡í•˜ê²Œ ì–½í˜€ì„œ ì‹¤í–‰ ì‹œê°„ì´ ë„ˆë¬´ í•œì—†ì´ ê¸¸ì–´ì§€ê¸°ì— ì¤„ì¼ ìˆ˜ ìˆëŠ” ë¶€ë¶„ì€ ì¤„ì—¬ë³´ì•˜ë‹¤. </b>
- <b>Angelaê°€ ì´ ì½”ë“œë¥¼ ì§œëŠ”ë° 2ì¼ì´ ê±¸ë ¸ë‹¤ëŠ” ëŒ“ê¸€ê³¼ ë‹¤ë¥¸ í˜„ì—…ì ì—­ì‹œ ì´ ì±Œë¦°ì§€ë¥¼ í•´ê²°í•˜ëŠ”ë° ëª‡ì¼ì´ ê±¸ë ¸ë‹¤ëŠ” ëŒ“ê¸€ì„ ë³´ê³  ê·¸ë˜ë„ ë§ì´ ë’¤ì³ì§€ê³  ìˆì§„ ì•Šêµ¬ë‚˜ í•˜ëŠ” ë§ˆìŒì˜ ìœ„ì•ˆì´ ë“¤ì—ˆë‹¤.</b>  

## 3. ê²°ë¡   

&nbsp;&nbsp;&nbsp;&nbsp;ì´ë²ˆ ê°•ì˜ì—ì„œëŠ” ê°€ì¥ ì‹œê°„ì´ ë§ì´ ê±¸ë¦° ì±Œë¦°ì§€ë¥¼ ì§„í–‰í•´ ë³´ì•˜ë‹¤. ê°€ì¥ ì‹œê°„ì´ ë§ì´ ê±¸ë¦°ë§Œí¼ ê°€ì¥ ë§ì€ ê²ƒë„ ì–»ì–´ê°€ëŠ” ì‹œê°„ì´ì—ˆë‹¤. ê·¸ë¦¬ê³  3ì¼ì— ê±¸ì³ ë§ˆì¹¨ë‚´ í•´ê²°í–ˆì„ ë•ŒëŠ” ê·¸ë™ì•ˆì˜ ì±Œë¦°ì§€ì™€ ë¹„êµí•  ìˆ˜ ì—†ëŠ” ì„±ì·¨ê°ë„ ë“¤ì—ˆë‹¤. ë‚´ì¼ì´ë©´ í•œì£¼ê°€ ì‹œì‘ëœë‹¤. ë‹¤ì‹œ í˜ë‚´ë³´ì!  

## 4. ì°¸ê³ ìë£Œ  

â… . [100 Days of Code: The Complete Python Pro Bootcamp for 2022](https://www.udemy.com/course/100-days-of-code/)

---

```bash
ì´ì œ ë§‰ í”„ë¡œê·¸ë˜ë° ê³µë¶€ë¥¼ ì‹œì‘í•œ ì´ˆë³´ ê°œë°œìì…ë‹ˆë‹¤.
ì´ ë¸”ë¡œê·¸ ê¸€ë“¤ì˜ ì£¼ ëª©ì ì€ ê³µë¶€í•œê²ƒì„ ë³µìŠµí•˜ê¸° ìœ„í•œê²ƒì´ë©°, 
ë§Œì•½ í‹€ë¦¬ê±°ë‚˜ ìˆ˜ì •í•˜ë©´ ì¢‹ì„ ë¶€ë¶„ë“¤ì€
ì¹œì ˆí•˜ê²Œ ëŒ“ê¸€ë‹¬ì•„ì£¼ì‹œë©´ ê°ì‚¬í•˜ê² ìŠµë‹ˆë‹¤. :)
```

---